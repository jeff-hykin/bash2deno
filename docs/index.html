<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <link rel="stylesheet" href="https://unpkg.com/css-baseline/css/2.css">
    </head>
    <body>
    </body>
    <script type="module">
        import { createEditor } from 'https://cdn.jsdelivr.net/gh/jeff-hykin/codemirror_esm@4cc6ded5e2f14dd3531a6dd8ff79fccbee5c366f/helpers.js'
        import { javascript } from 'https://cdn.jsdelivr.net/gh/jeff-hykin/codemirror_esm@4cc6ded5e2f14dd3531a6dd8ff79fccbee5c366f/@codemirror/lang-javascript.js'
        import { shell } from 'https://cdn.jsdelivr.net/gh/jeff-hykin/codemirror_esm@4cc6ded5e2f14dd3531a6dd8ff79fccbee5c366f/@codemirror/lang-shell.js'
        import { throttle } from 'https://esm.sh/gh/jeff-hykin/good-js@1.18.2.0/source/flattened/throttle.js'
        
        import { translate } from 'https://esm.sh/gh/jeff-hykin/bash2deno@master/api.js'
        var { html, passAlongProps } = await import("https://esm.sh/gh/jeff-hykin/elemental@0.6.5/main/deno.js?dev")
        
        const warningsDiv = html`<div style=${`
            height: 12rem;
            position: fixed;
            left: 0;
            bottom: 0;
            background-color: gray;
            overflow-y: scroll;
        `}/>`

        const javascriptEditor = createEditor({
            style: "width:50vw;height:100vh",
            language: javascript,
        })
        
        const shellEditor = createEditor({
            style: "width:50vw;height:100vh",
            language: shell,
            value: `
                echo hello > file.txt
            `.replace(/\n                /g, "\n").slice(1),
            onInput: throttle(500, ({element, editor}, update)=>{
                try {
                    const { jsCode, xmlStylePreview } = translate(element.value)
                    javascriptEditor.value = jsCode
                    // warningsDiv.innerHTML = warnings.map(each=>`<span>${each}</span>`.replace(/\n/g,"<br>")).join("<br>")
                } catch (error) {
                    warningsDiv.innerHTML = error.message + "\n" + error.stack.replace(/\n/g,"<br>")
                }
            }),
        })
        
        document.body = html`<body display=flex>
            ${shellEditor}
            ${javascriptEditor}
            ${warningsDiv}
        </body>`
    </script>
</html>